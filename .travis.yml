language: java
sudo: false # Use a container-based environment without root access
install: true # Skip the 'install' step, since there's nothing special to install

cache:
 directories:
   - $HOME/.m2 # Maven artifact repository

jdk:
  - oraclejdk9

addons:
  sonarcloud: true
  apt:
    packages:
      - oracle-java9-installer # Use apt to download and install a more recent update of the JDK in version 9

jobs:
  include:
    - name: compile
      script: mvn --errors clean:clean compiler:compile resources:resources native2ascii:resources sonar-packaging:sonar-plugin
    - name: print_working_directory
      script: "pwd"
    - name: before-deploy
      script:
        - "echo ls target/*.jar"
        - "echo ls target/resharper-clt-plugin-*.jar"
    - name: GitHub Release
      script: echo "Deploying to GitHub releases ..."
      deploy:
        # GitHub Releases uses git tags.
        on.tags: true
        provider: releases
        # Set in the settings page of your repository, as a secure variable
        api_key: $GITHUB_OAUTH_TOKEN
        # Enable globbing for file names as the resulting binary will contain its version number
        file_glob: true
        file: target/resharper-clt-plugin-*.jar
        # Make sure you have skip_cleanup set to true, otherwise Travis CI will delete all the files created during the build
        skip_cleanup: true
        # NOTE: As long as I am testing this feature, I'll allow overwriting of released binaries
        overwrite: true
        # NOTE: As long as I am testing this feature, I'll mark each release as draft
        draft: true
        prerelease: true
